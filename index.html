<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ‹å°è¨­å‚™ç›¤é»ç³»çµ±</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
      background: #181B22;
      color: #FFF;
      line-height: 1.6;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #25272F;
      padding: 15px 20px;
      border-bottom: 2px solid #23252C;
      flex-wrap: wrap;
    }
    
    h1 {
      font-size: 1.8rem;
      margin: 0;
      flex: 1;
      min-width: 200px;
    }
    
    .header-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .main-content {
      display: flex;
      min-height: calc(100vh - 80px);
      flex-direction: row;
    }
    
    .sidebar {
      width: 280px;
      background: #22232C;
      padding: 20px 15px;
      border-right: 2px solid #23252C;
      overflow-y: auto;
    }
    
    .sidebar h2 {
      margin-top: 0;
      font-size: 1.3rem;
    }
    
    .sidebar input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #35394D;
      background: #23263A;
      color: #fff;
      font-size: 1rem;
    }
    
    #classroom-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    
    #classroom-list li {
      margin-bottom: 8px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: background 0.15s;
      font-size: 0.95rem;
    }
    
    #classroom-list li.selected,
    #classroom-list li:hover {
      background: #444556;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.15s;
      font-weight: bold;
    }
    
    .btn-primary {
      background: #555BE3;
      color: #fff;
    }
    
    .btn-primary:hover {
      background: #7D83F3;
    }
    
    .btn-success {
      background: #28a745;
      color: #fff;
    }
    
    .btn-success:hover {
      background: #218838;
    }
    
    .btn-theme {
      background: #4347AB;
      color: #fff;
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    .btn-theme:hover {
      background: #585FFF;
    }
    
    .content {
      flex: 1;
      padding: 20px;
      overflow-x: auto;
    }
    
    .search-bar {
      margin-bottom: 20px;
    }
    
    #search-input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #35394D;
      background: #23263A;
      color: #fff;
      font-size: 1rem;
    }
    
    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .stat-card {
      background: #23263A;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      min-width: 120px;
      flex: 1;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    #equipment-table {
      width: 100%;
      border-collapse: collapse;
      background: #23263A;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(24, 27, 34, 0.3);
    }
    
    #equipment-table th,
    #equipment-table td {
      padding: 12px 8px;
      text-align: center;
      font-size: 0.9rem;
    }
    
    #equipment-table th {
      background: #2a2d3a;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    #equipment-table tbody tr {
      transition: background 0.1s;
    }
    
    #equipment-table tbody tr:hover {
      background: #343C55;
    }
    
    .status-cell {
      font-weight: bold;
      border-radius: 6px;
      padding: 6px 12px;
      display: inline-block;
      cursor: pointer;
      user-select: none;
      min-width: 70px;
      font-size: 0.85rem;
    }
    
    .status-unchecked {
      background: #FFB26B;
      color: #31210C;
    }
    
    .status-checked {
      background: #77E6B6;
      color: #085D45;
    }
    
    .qr-scanner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .qr-scanner-content {
      background: #23263A;
      padding: 20px;
      border-radius: 15px;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }
    
    #qr-video {
      width: 100%;
      max-width: 300px;
      height: 300px;
      border-radius: 10px;
      margin: 10px 0;
    }
    
    .close-scanner {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ff4757;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 2px solid #23252C;
        max-height: 300px;
      }
      
      .header {
        padding: 10px 15px;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .header-buttons {
        width: 100%;
        justify-content: flex-end;
        margin-top: 10px;
      }
      
      .stats {
        gap: 10px;
      }
      
      .stat-card {
        min-width: 100px;
      }
      
      #equipment-table {
        font-size: 0.8rem;
      }
      
      #equipment-table th,
      #equipment-table td {
        padding: 8px 4px;
      }
      
      .status-cell {
        padding: 4px 8px;
        font-size: 0.75rem;
        min-width: 60px;
      }
    }
    
    @media (max-width: 480px) {
      .content {
        padding: 15px 10px;
      }
      
      .sidebar {
        padding: 15px 10px;
      }
      
      #equipment-table th:nth-child(3),
      #equipment-table td:nth-child(3) {
        display: none;
      }
    }
    
    /* ä¸»é¡Œæ¨£å¼ */
    .theme-high-contrast .status-unchecked {
      background: #FF4665;
      color: #fff;
    }
    
    .theme-high-contrast .status-checked {
      background: #1BE7FF;
      color: #16344E;
    }
    
    .theme-colorblind .status-unchecked {
      background: #FFD700;
      color: #634500;
    }
    
    .theme-colorblind .status-checked {
      background: #339933;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>åœ‹å°è¨­å‚™ç›¤é»ç³»çµ±</h1>
    <div class="header-buttons">
      <button id="qr-scan-btn" class="btn btn-success">ğŸ“± æƒç¢¼ç›¤é»</button>
      <button id="theme-toggle" class="btn btn-theme">åˆ‡æ›ä¸»é¡Œ</button>
    </div>
  </div>
  
  <div class="main-content">
    <div class="sidebar">
      <h2>ğŸ“‹ æ•™å®¤ç¯©é¸</h2>
      <input type="text" id="classroom-search" placeholder="ğŸ” æœå°‹æ•™å®¤...">
      <ul id="classroom-list"></ul>
      <button id="export-btn" class="btn btn-primary">ğŸ“¤ åŒ¯å‡ºå ±è¡¨</button>
      <button id="reset-btn" class="btn btn-primary">ğŸ”„ é‡ç½®ç‹€æ…‹</button>
    </div>
    
    <div class="content">
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="ğŸ” æœå°‹è¨­å‚™ç·¨è™Ÿã€åç¨±...">
      </div>
      
      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="total-count">0</div>
          <div class="stat-label">ç¸½è¨­å‚™æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="checked-count">0</div>
          <div class="stat-label">å·²ç›¤é»</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="unchecked-count">0</div>
          <div class="stat-label">æœªç›¤é»</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="progress-percent">0%</div>
          <div class="stat-label">å®Œæˆç‡</div>
        </div>
      </div>
      
      <table id="equipment-table">
        <thead>
          <tr>
            <th>ç·¨è™Ÿ</th>
            <th>åç¨±</th>
            <th>æ•™å®¤</th>
            <th>ç‹€æ…‹</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
  <!-- QR æƒæå™¨ -->
  <div class="qr-scanner" id="qr-scanner">
    <button class="close-scanner" onclick="closeQRScanner()">Ã—</button>
    <div class="qr-scanner-content">
      <h3>ğŸ“± QR Code æƒæå™¨</h3>
      <video id="qr-video"></video>
      <p>è«‹å°‡ QR Code å°æº–é¡é ­</p>
      <button onclick="closeQRScanner()" class="btn btn-primary">é—œé–‰æƒæå™¨</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.umd.min.js"></script>
  <script>
    // è¨­å‚™ç›¤é»ç³»çµ±ä¸»è¦åŠŸèƒ½
    let data = [];
    let classrooms = [];
    let currentClassroom = null;
    let theme = 'default';
    let qrScanner = null;

    // æ¨¡æ“¬è¨­å‚™è³‡æ–™
    const mockData = [
      { ç·¨è™Ÿ: 'EQ001', åç¨±: 'æŠ•å½±æ©Ÿ', æ•™å®¤: '101æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ002', åç¨±: 'é›»è…¦', æ•™å®¤: '101æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ003', åç¨±: 'éŸ³éŸ¿', æ•™å®¤: '102æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ004', åç¨±: 'ç™½æ¿', æ•™å®¤: '102æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ005', åç¨±: 'æƒæå™¨', æ•™å®¤: '103æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ006', åç¨±: 'å°è¡¨æ©Ÿ', æ•™å®¤: '103æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ007', åç¨±: 'æ”å½±æ©Ÿ', æ•™å®¤: 'éŸ³æ¨‚æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ008', åç¨±: 'é‹¼ç´', æ•™å®¤: 'éŸ³æ¨‚æ•™å®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ009', åç¨±: 'ç±ƒçƒ', æ•™å®¤: 'é«”è‚²å™¨æå®¤', ç‹€æ…‹: 'æœªç›¤é»' },
      { ç·¨è™Ÿ: 'EQ010', åç¨±: 'æ’çƒ', æ•™å®¤: 'é«”è‚²å™¨æå®¤', ç‹€æ…‹: 'æœªç›¤é»' }
    ];

    // ç‹€æ…‹æ¨£å¼æ˜ å°„
    const statusMap = {
      'æœªç›¤é»': 'status-unchecked',
      'å·²ç›¤é»': 'status-checked'
    };

    // åˆå§‹åŒ–ç³»çµ±
    function initSystem() {
      // è¼‰å…¥æˆ–ä½¿ç”¨æ¨¡æ“¬è³‡æ–™
      data = mockData.slice();
      
      // æ¢å¾©å·²å„²å­˜çš„ç‹€æ…‹
      restoreStatus();
      
      // å»ºç«‹æ•™å®¤æ¸…å–®
      classrooms = Array.from(new Set(data.map(d => d.æ•™å®¤))).sort();
      
      // æ¸²æŸ“ä»‹é¢
      renderClassroomList();
      renderTable();
      updateStats();
      
      // ç¶å®šäº‹ä»¶
      bindEvents();
    }

    // ç¶å®šäº‹ä»¶ç›£è½å™¨
    function bindEvents() {
      document.getElementById('search-input').addEventListener('input', renderTable);
      document.getElementById('classroom-search').addEventListener('input', filterClassrooms);
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      document.getElementById('export-btn').addEventListener('click', exportData);
      document.getElementById('reset-btn').addEventListener('click', resetStatus);
      document.getElementById('qr-scan-btn').addEventListener('click', startQRScanner);
    }

    // ä¸»é¡Œåˆ‡æ›
    function toggleTheme() {
      if (theme === 'default') theme = 'high-contrast';
      else if (theme === 'high-contrast') theme = 'colorblind';
      else theme = 'default';
      
      applyTheme();
      renderTable();
    }

    function applyTheme() {
      document.body.classList.remove('theme-high-contrast', 'theme-colorblind');
      if (theme === 'high-contrast') document.body.classList.add('theme-high-contrast');
      if (theme === 'colorblind') document.body.classList.add('theme-colorblind');
    }

    // æ¸²æŸ“æ•™å®¤æ¸…å–®
    function renderClassroomList() {
      const list = document.getElementById('classroom-list');
      list.innerHTML = '';
      
      // å…¨éƒ¨é¸é …
      const allItem = document.createElement('li');
      allItem.textContent = 'ğŸ“š å…¨éƒ¨æ•™å®¤';
      allItem.className = currentClassroom ? '' : 'selected';
      allItem.onclick = () => {
        currentClassroom = null;
        renderTable();
        renderClassroomList();
      };
      list.appendChild(allItem);
      
      // å„æ•™å®¤é¸é …
      classrooms.forEach(cls => {
        const li = document.createElement('li');
        li.textContent = `ğŸ« ${cls}`;
        li.className = (currentClassroom === cls) ? 'selected' : '';
        li.onclick = () => {
          currentClassroom = cls;
          renderTable();
          renderClassroomList();
        };
        list.appendChild(li);
      });
    }

    // éæ¿¾æ•™å®¤
    function filterClassrooms() {
      const keyword = document.getElementById('classroom-search').value.trim().toLowerCase();
      const items = document.querySelectorAll('#classroom-list li');
      
      items.forEach((item, index) => {
        if (index === 0) return; // è·³é"å…¨éƒ¨"é¸é …
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(keyword) ? '' : 'none';
      });
    }

    // æ¸²æŸ“è¨­å‚™è¡¨æ ¼
    function renderTable() {
      const keyword = document.getElementById('search-input').value.trim().toLowerCase();
      const tbody = document.querySelector('#equipment-table tbody');
      tbody.innerHTML = '';
      
      let filteredData = data.filter(d => 
        (!currentClassroom || d.æ•™å®¤ === currentClassroom) &&
        (d.ç·¨è™Ÿ.toLowerCase().includes(keyword) || 
         d.åç¨±.toLowerCase().includes(keyword) ||
         d.æ•™å®¤.toLowerCase().includes(keyword))
      );
      
      filteredData.forEach(d => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><strong>${d.ç·¨è™Ÿ}</strong></td>
          <td>${d.åç¨±}</td>
          <td>${d.æ•™å®¤}</td>
          <td>
            <span class="status-cell ${statusMap[d.ç‹€æ…‹] || 'status-unchecked'}" 
                  onclick="toggleStatus('${d.ç·¨è™Ÿ}')">${d.ç‹€æ…‹}</span>
          </td>
          <td>
            <button onclick="toggleStatus('${d.ç·¨è™Ÿ}')" class="btn" style="padding: 5px 10px; font-size: 0.8rem;">
              ${d.ç‹€æ…‹ === 'æœªç›¤é»' ? 'âœ… ç›¤é»' : 'âŒ å–æ¶ˆ'}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      updateStats();
    }

    // åˆ‡æ›è¨­å‚™ç‹€æ…‹
    function toggleStatus(equipmentId) {
      const item = data.find(d => d.ç·¨è™Ÿ === equipmentId);
      if (item) {
        item.ç‹€æ…‹ = item.ç‹€æ…‹ === 'æœªç›¤é»' ? 'å·²ç›¤é»' : 'æœªç›¤é»';
        saveStatus();
        renderTable();
        
        // é¡¯ç¤ºæç¤º
        showToast(`${item.ç·¨è™Ÿ} - ${item.åç¨±} å·²${item.ç‹€æ…‹}`);
      }
    }

    // æ›´æ–°çµ±è¨ˆè³‡è¨Š
    function updateStats() {
      const filteredData = currentClassroom ? 
        data.filter(d => d.æ•™å®¤ === currentClassroom) : data;
      
      const total = filteredData.length;
      const checked = filteredData.filter(d => d.ç‹€æ…‹ === 'å·²ç›¤é»').length;
      const unchecked = total - checked;
      const progress = total > 0 ? Math.round((checked / total) * 100) : 0;
      
      document.getElementById('total-count').textContent = total;
      document.getElementById('checked-count').textContent = checked;
      document.getElementById('unchecked-count').textContent = unchecked;
      document.getElementById('progress-percent').textContent = `${progress}%`;
      
      // æ›´æ–°é€²åº¦é¡è‰²
      const progressElement = document.getElementById('progress-percent');
      if (progress === 100) {
        progressElement.style.color = '#77E6B6';
      } else if (progress >= 50) {
        progressElement.style.color = '#FFB26B';
      } else {
        progressElement.style.color = '#FF6B6B';
      }
    }

    // å„²å­˜ç‹€æ…‹
    function saveStatus() {
      const statusData = data.map(d => ({ ç·¨è™Ÿ: d.ç·¨è™Ÿ, ç‹€æ…‹: d.ç‹€æ…‹ }));
      // åœ¨çœŸå¯¦ç’°å¢ƒä¸­æœƒä½¿ç”¨ localStorage
      console.log('å„²å­˜ç‹€æ…‹:', statusData);
    }

    // æ¢å¾©ç‹€æ…‹
    function restoreStatus() {
      // åœ¨çœŸå¯¦ç’°å¢ƒä¸­æœƒå¾ localStorage è®€å–
      console.log('æ¢å¾©ç‹€æ…‹');
    }

    // é‡ç½®æ‰€æœ‰ç‹€æ…‹
    function resetStatus() {
      if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨­å‚™çš„ç›¤é»ç‹€æ…‹å—ï¼Ÿ')) {
        data.forEach(d => d.ç‹€æ…‹ = 'æœªç›¤é»');
        saveStatus();
        renderTable();
        showToast('æ‰€æœ‰è¨­å‚™ç‹€æ…‹å·²é‡ç½®');
      }
    }

    // åŒ¯å‡ºè³‡æ–™
    function exportData() {
      let csv = "ç·¨è™Ÿ,åç¨±,æ•™å®¤,ç‹€æ…‹\n";
      data.forEach(d => {
        csv += `${d.ç·¨è™Ÿ},${d.åç¨±},${d.æ•™å®¤},${d.ç‹€æ…‹}\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `è¨­å‚™ç›¤é»å ±è¡¨_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('å ±è¡¨å·²åŒ¯å‡º');
    }

    // QR Code æƒæåŠŸèƒ½
    function startQRScanner() {
      const scanner = document.getElementById('qr-scanner');
      const video = document.getElementById('qr-video');
      
      scanner.style.display = 'flex';
      
      // æª¢æŸ¥æ˜¯å¦æ”¯æ´ç›¸æ©Ÿ
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'environment' } 
        })
        .then(stream => {
          video.srcObject = stream;
          video.play();
          
          // ä½¿ç”¨ QR Scanner ç¨‹å¼åº«
          if (typeof QrScanner !== 'undefined') {
            qrScanner = new QrScanner(video, result => {
              handleQRResult(result);
            });
            qrScanner.start();
          } else {
            // ç°¡åŒ–ç‰ˆï¼šæ¨¡æ“¬ QR æƒæ
            showToast('è«‹é»æ“Šè¨­å‚™ç·¨è™Ÿé€²è¡Œæ‰‹å‹•ç›¤é»');
          }
        })
        .catch(err => {
          console.error('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿ:', err);
          showToast('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼Œè«‹æª¢æŸ¥æ¬Šé™è¨­å®š');
          closeQRScanner();
        });
      } else {
        showToast('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ç›¸æ©ŸåŠŸèƒ½');
        closeQRScanner();
      }
    }

    function closeQRScanner() {
      const scanner = document.getElementById('qr-scanner');
      const video = document.getElementById('qr-video');
      
      scanner.style.display = 'none';
      
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(track => track.stop());
      }
      
      if (qrScanner) {
        qrScanner.stop();
        qrScanner = null;
      }
    }

    function handleQRResult(result) {
      const equipmentId = result.data || result;
      const item = data.find(d => d.ç·¨è™Ÿ === equipmentId);
      
      if (item) {
        item.ç‹€æ…‹ = 'å·²ç›¤é»';
        saveStatus();
        renderTable();
        showToast(`âœ… ${item.ç·¨è™Ÿ} - ${item.åç¨±} ç›¤é»å®Œæˆ`);
      } else {
        showToast(`âŒ æ‰¾ä¸åˆ°è¨­å‚™ç·¨è™Ÿ: ${equipmentId}`);
      }
      
      closeQRScanner();
    }

    // é¡¯ç¤ºæç¤ºè¨Šæ¯
    function showToast(message) {
      // å‰µå»ºæç¤ºå…ƒç´ 
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #23263A;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 1001;
        font-weight: bold;
        max-width: 300px;
        word-wrap: break-word;
      `;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 3000);
    }

    // åˆå§‹åŒ–ç³»çµ±
    document.addEventListener('DOMContentLoaded', initSystem);
    
    // å…¨åŸŸå‡½æ•¸
    window.closeQRScanner = closeQRScanner;
    window.toggleStatus = toggleStatus;
  </script>
</body>
</html>
